var ImageUploadModalMode,WikimediaPreview,ImageUploadModal;(function(n){n._map=[],n._map[0]="Wikimedia",n.Wikimedia=0,n._map[1]="Upload",n.Upload=1})(ImageUploadModalMode||(ImageUploadModalMode={})),WikimediaPreview=function(){function n(){this.SuccessfullyLoaded=!1}return n.prototype.Load=function(){$("#divWikimediaSpinner").show(),$("#divWikimediaError").hide(),$("#previewWikimediaImage").hide();var t=$("#txtWikimediaUrl").val(),n=this;$.ajax({type:"POST","true":!1,cache:!1,url:"/ImageUpload/FromWikimedia/",data:"url="+t,error:function(n){console.log(n),alert("Ein Fehler ist aufgetreten.")},success:function(i){if($("#divWikimediaSpinner").hide(),i.ImageNotFound){$("#divWikimediaError").show(),n.SuccessfullyLoadedImageUrl="",n.SuccessfullyLoaded=!1;return}n.SuccessfullyLoadedImageUrl=t,n.SuccessfullyLoaded=!0,n.ImageThumbUrl=i.ImageThumbUrl,$("#previewWikimediaImage").html('<b>Bildvorschau:<\/b><br/><img src="'+i.ImageThumbUrl+'"> '),$("#previewWikimediaImage").show(),$("#modalBody").stop().scrollTo("100%",800)}})},n}(),ImageUploadModal=function(){function n(){this.WikimediaPreview=new WikimediaPreview,this._mode=ImageUploadModalMode.Wikimedia,this.InitUploader(),this.InitTypeRadios(),this.InitLicenceRadio();var n=this;$("#txtWikimediaUrl").change(function(){n.WikimediaPreview.Load()}),$("#aSaveImage").click(function(){n.SaveImage()})}return n.prototype.InitUploader=function(){var n=this;$("#fileUpload").fineUploader({uploaderType:"basic",button:$("#fileUpload")[0],request:{endpoint:$("#modalImageUpload").attr("data-endpoint")},multiple:!1,debug:!1,validation:{allowedExtensions:["jpeg","jpg","png"],sizeLimit:2097152}}).on("error",function(){alert("Ein Fehler ist aufgetreten")}).on("complete",function(t,i,r,u){$("#divUploadProgress").hide(),$("#previewImage").html('<b>Bildvorschau:<\/b><br/><img src="'+u.filePath+'"> '),$("#previewImage").show(),$("#divLegalInfo").show(),$("#modalBody").stop().scrollTo("100%",800),n.ImageThumbUrl=u.filePath}).on("progress",function(n,t,i){$("#previewImage").hide(),$("#divUploadProgress").show(),$("#divUploadProgress").html("'<b>"+i+"<\/b>' wird hochgeladen.")})},n.prototype.InitTypeRadios=function(){var n=this;$("#rdoImageWikimedia").change(function(){$(this).is(":checked")&&($("#divUpload").hide(),$("#divWikimedia").show(),n._mode=ImageUploadModalMode.Wikimedia)}),$("#rdoImageUpload").change(function(){$(this).is(":checked")&&($("#divUpload").show(),$("#divWikimedia").hide(),n._mode=ImageUploadModalMode.Upload)})},n.prototype.InitLicenceRadio=function(){$("#rdoLicenceByUloader").change(function(){$(this).is(":checked")&&($("#divLicenceUploader").show(),$("#divLicenceForeign").hide())}),$("#rdoLicenceForeign").change(function(){$(this).is(":checked")&&($("#divLicenceUploader").hide(),$("#divLicenceForeign").show())})},n.prototype.SaveImage=function(){this._mode==ImageUploadModalMode.Wikimedia&&this.SaveWikimediaImage(),this._mode==ImageUploadModalMode.Upload&&this.SaveUploadedImage()},n.prototype.SaveWikimediaImage=function(){this.WikimediaPreview.SuccessfullyLoaded?(console.log(this.WikimediaPreview),this._onSave(this.WikimediaPreview.ImageThumbUrl)):alert("Bitte lade ein Bild über eine Wikipedia URL.")},n.prototype.SaveUploadedImage=function(){if($("#rdoLicenceForeign").is(":checked")||$("#rdoLicenceByUloader").is(":checked")||alert("Bitte wähle eine andere Lizenz"),$("#rdoLicenceForeign").is(":checked")&&alert("Bitte wähle eine andere Lizenz. Wir bitten Dich das Bild auf Wikimedia hochzuladen und so einzubinden."),$("#rdoLicenceByUloader").is(":checked")){var n=$("#txtLicenceOwner").val();n.trim()==""&&alert("Bitte gib Deinen Namen als Lizenzgeber an."),this._onSave(this.ImageThumbUrl)}},n.prototype.OnSave=function(n){this._onSave=n},n}()